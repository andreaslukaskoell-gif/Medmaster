import fs from 'fs';
import path from 'path';

// Comprehensive German Umlaut replacement map
// Order matters: longer/more specific patterns first
const replacements = [
  // === Specific multi-word/compound fixes ===
  ['Transplantatabstossung', 'Transplantatabstoßung'],
  ['Abstossungsreaktion', 'Abstoßungsreaktion'],
  ['Abstossungsrisiko', 'Abstoßungsrisiko'],
  ['Antwortmoeglichkeiten', 'Antwortmöglichkeiten'],
  ['Oberflaechenproteine', 'Oberflächenproteine'],
  ['Einschraenkung', 'Einschränkung'],
  ['auszuschliessen', 'auszuschließen'],
  ['aneinanderstossen', 'aneinanderstoßen'],
  ['Loesungsfigur', 'Lösungsfigur'],
  ['haengenbleiben', 'hängenbleiben'],
  ['festbeissen', 'festbeißen'],
  ['Natriumkanaelen', 'Natriumkanälen'],
  ['Kalium-Leckkanaele', 'Kalium-Leckkanäle'],
  ['Leckkanaele', 'Leckkanäle'],
  ['Kanaele', 'Kanäle'],
  ['kanaele', 'kanäle'],
  ['intrazellullaer', 'intrazellulär'],
  ['extrazellullaer', 'extrazellulär'],
  ['interzellullaer', 'interzellulär'],
  ['zellulaerem', 'zellulärem'],
  ['zellulaer', 'zellulär'],
  ['Zyklushaelfte', 'Zyklushälfte'],

  // === ue → ü patterns ===
  ['Molekuelgeometrie', 'Molekülgeometrie'],
  ['Molekuelgroesse', 'Molekülgröße'],
  ['Molekuelform', 'Molekülform'],
  ['Molekuelinneren', 'Molekülinneren'],
  ['Molekuelen', 'Molekülen'],
  ['Molekuele', 'Moleküle'],
  ['Molekuel', 'Molekül'],
  ['muessen', 'müssen'],
  ['Uebertragung', 'Übertragung'],
  ['Ueberlege', 'Überlege'],
  ['uebersehen', 'übersehen'],
  ['uebrigen', 'übrigen'],
  ['Uebung', 'Übung'],
  ['Luecken', 'Lücken'],
  ['lueckenlos', 'lückenlos'],
  ['luecke', 'lücke'],
  ['wuerden', 'würden'],
  ['wuerde', 'würde'],
  ['Zurueck', 'Zurück'],
  ['zurueck', 'zurück'],
  ['begruendet', 'begründet'],
  ['begruendete', 'begründete'],
  ['Pruefe', 'Prüfe'],
  ['pruefe', 'prüfe'],
  ['Fuenf', 'Fünf'],
  ['fuenf', 'fünf'],
  ['Spuelen', 'Spülen'],
  ['spuelen', 'spülen'],
  ['Buendel', 'Bündel'],
  ['buendel', 'bündel'],
  ['Gruende', 'Gründe'],
  ['gruende', 'gründe'],
  ['Schueler', 'Schüler'],
  ['schueler', 'schüler'],
  ['Einfuehrung', 'Einführung'],
  ['einfuehrung', 'einführung'],
  ['Ausfuehr', 'Ausführ'],
  ['Durchfuehr', 'Durchführ'],
  ['ausfuehr', 'ausführ'],
  ['Stueck', 'Stück'],
  ['stueck', 'stück'],
  ['Glueck', 'Glück'],
  ['glueck', 'glück'],
  ['genueg', 'genüg'],
  ['Genueg', 'Genüg'],
  ['Verguet', 'Vergüt'],
  ['waeren', 'wären'],
  ['Waeren', 'Wären'],

  // === oe → ö patterns ===
  ['Loesungen', 'Lösungen'],
  ['Loesung', 'Lösung'],
  ['loesung', 'lösung'],
  ['loesen', 'lösen'],
  ['koennten', 'könnten'],
  ['koennte', 'könnte'],
  ['koennen', 'können'],
  ['Koennen', 'Können'],
  ['noetig', 'nötig'],
  ['Erschoepfung', 'Erschöpfung'],
  ['Erschoepf', 'Erschöpf'],
  ['verzoegert', 'verzögert'],
  ['verzoeger', 'verzöger'],
  ['oeffentlich', 'öffentlich'],
  ['Oeffentlich', 'Öffentlich'],
  ['Moeglichkeit', 'Möglichkeit'],
  ['moeglichkeit', 'möglichkeit'],
  ['Moeglich', 'Möglich'],
  ['moeglich', 'möglich'],
  ['Boegen', 'Bögen'],
  ['groessten', 'größten'],
  ['groesste', 'größte'],
  ['groesser', 'größer'],
  ['Groesse', 'Größe'],
  ['groesse', 'größe'],
  ['grossteils', 'großteils'],
  ['Sproede', 'Spröde'],
  ['sproede', 'spröde'],
  ['Stoerung', 'Störung'],
  ['stoerung', 'störung'],
  ['Hoehe', 'Höhe'],
  ['hoehe', 'höhe'],
  ['gehoert', 'gehört'],
  ['Gehoert', 'Gehört'],
  ['erhoeh', 'erhöh'],
  ['Erhoeh', 'Erhöh'],
  ['Foerder', 'Förder'],
  ['foerder', 'förder'],
  ['woertlich', 'wörtlich'],

  // === ae → ä patterns ===
  ['Erklaerung', 'Erklärung'],
  ['erklaerung', 'erklärung'],
  ['Erklaert', 'Erklärt'],
  ['erklaert', 'erklärt'],
  ['Erklaer', 'Erklär'],
  ['erklaer', 'erklär'],
  ['Oberflaech', 'Oberfläch'],
  ['oberflaech', 'oberfläch'],
  ['auffaelligsten', 'auffälligsten'],
  ['auffaelligen', 'auffälligen'],
  ['auffaellig', 'auffällig'],
  ['aeusseren', 'äußeren'],
  ['aeusseres', 'äußeres'],
  ['aeusser', 'äußer'],
  ['Aerzt', 'Ärzt'],
  ['autoritaer', 'autoritär'],
  ['Aequivalenzpunkt', 'Äquivalenzpunkt'],
  ['aequivalent', 'äquivalent'],
  ['Aequivalent', 'Äquivalent'],
  ['Aequi', 'Äqui'],
  ['aequi', 'äqui'],
  ['Empfaenger', 'Empfänger'],
  ['empfaenger', 'empfänger'],
  ['Empfaeng', 'Empfäng'],
  ['haetten', 'hätten'],
  ['haette', 'hätte'],
  ['haengen', 'hängen'],
  ['Faehigkeit', 'Fähigkeit'],
  ['faehigkeit', 'fähigkeit'],
  ['Faehig', 'Fähig'],
  ['faehig', 'fähig'],
  ['Staerke', 'Stärke'],
  ['staerke', 'stärke'],
  ['Schwaeche', 'Schwäche'],
  ['schwaeche', 'schwäche'],
  ['Textverstaendnis', 'Textverständnis'],
  ['Verstaendnis', 'Verständnis'],
  ['verstaendnis', 'verständnis'],
  ['Ueberblick', 'Überblick'],
  ['ueberblick', 'überblick'],
  ['Uebungsfragen', 'Übungsfragen'],
  ['naechst', 'nächst'],
  ['Naechst', 'Nächst'],
  ['waehle', 'wähle'],
  ['Waehle', 'Wähle'],
  ['spaeter', 'später'],
  ['Spaeter', 'Später'],
  ['Praezis', 'Präzis'],
  ['praezis', 'präzis'],
  ['ungefaehr', 'ungefähr'],
  ['Ungefaehr', 'Ungefähr'],

  // === Additional ae → ä patterns ===
  ['hauptsaechlich', 'hauptsächlich'],
  ['tatsaechlich', 'tatsächlich'],
  ['saechlich', 'sächlich'],
  ['zunaechst', 'zunächst'],
  ['Zunaechst', 'Zunächst'],
  ['nachtraeg', 'nachträg'],
  ['Nachtraeg', 'Nachträg'],
  ['schaedlich', 'schädlich'],
  ['Schaedlich', 'Schädlich'],
  ['gefaehrlich', 'gefährlich'],
  ['Gefaehrlich', 'Gefährlich'],
  ['ungefaehr', 'ungefähr'],
  ['regelmaessig', 'regelmäßig'],
  ['Regelmaessig', 'Regelmäßig'],
  ['waehrend', 'während'],
  ['Waehrend', 'Während'],
  ['spaet', 'spät'],
  ['Spaet', 'Spät'],
  ['taeg', 'täg'],
  ['Taeg', 'Täg'],
  ['schaetz', 'schätz'],
  ['Schaetz', 'Schätz'],
  ['Naehr', 'Nähr'],
  ['naehr', 'nähr'],
  ['Traeg', 'Träg'],
  ['traeg', 'träg'],
  ['Baender', 'Bänder'],
  ['baender', 'bänder'],
  ['Gaenge', 'Gänge'],
  ['gaenge', 'gänge'],
  ['Laenge', 'Länge'],
  ['laenge', 'länge'],
  ['laenger', 'länger'],
  ['Laenger', 'Länger'],
  ['Kaelt', 'Kält'],
  ['kaelt', 'kält'],
  ['Waerm', 'Wärm'],
  ['waerm', 'wärm'],
  ['Maenn', 'Männ'],
  ['maenn', 'männ'],
  ['Aerger', 'Ärger'],
  ['aerger', 'ärger'],

  // === Additional oe → ö patterns ===
  ['hoechst', 'höchst'],
  ['Hoechst', 'Höchst'],
  ['voellig', 'völlig'],
  ['Voellig', 'Völlig'],
  ['gewoeh', 'gewöh'],
  ['Gewoeh', 'Gewöh'],
  ['Stoech', 'Stöch'],
  ['stoech', 'stöch'],
  ['roentgen', 'röntgen'],
  ['Roentgen', 'Röntgen'],

  // === Additional ue → ü patterns ===
  ['uebernimmt', 'übernimmt'],
  ['uebernehm', 'übernehm'],
  ['Uebernehm', 'Übernehm'],
  ['Ausueb', 'Ausüb'],
  ['ausueb', 'ausüb'],
  ['Ausfuehr', 'Ausführ'],
  ['Verfueg', 'Verfüg'],
  ['verfueg', 'verfüg'],
  ['Einfuehr', 'Einführ'],
  ['Ausfuell', 'Ausfüll'],
  ['Erfuell', 'Erfüll'],
  ['erfuell', 'erfüll'],
  ['Spuer', 'Spür'],
  ['spuer', 'spür'],
  ['Natuerl', 'Natürl'],
  ['natuerl', 'natürl'],
  ['kuenstl', 'künstl'],
  ['Kuenstl', 'Künstl'],
  ['wuensch', 'wünsch'],
  ['Wuensch', 'Wünsch'],

  // === Additional missed patterns ===
  ['duerfen', 'dürfen'],
  ['Duerfen', 'Dürfen'],
  ['prueft', 'prüft'],
  ['Prueft', 'Prüft'],
  ['raeumlich', 'räumlich'],
  ['Raeumlich', 'Räumlich'],
  ['Vorstellungsvermoegen', 'Vorstellungsvermögen'],
  ['vermoegen', 'vermögen'],
  ['Vermoegen', 'Vermögen'],
  ['Flaeche', 'Fläche'],
  ['flaeche', 'fläche'],
  ['Haeufig', 'Häufig'],
  ['haeufig', 'häufig'],
  ['Flaechenverhaeltnis', 'Flächenverhältnis'],
  ['Groessenverhaeltnisse', 'Größenverhältnisse'],
  ['Verhaeltnis', 'Verhältnis'],
  ['verhaeltnis', 'verhältnis'],
  ['ploetzlich', 'plötzlich'],
  ['Ploetzlich', 'Plötzlich'],
  ['ausfuellen', 'ausfüllen'],
  ['Ausfuellen', 'Ausfüllen'],
  ['kreuzfoermig', 'kreuzförmig'],
  ['foermig', 'förmig'],
  ['schraegen', 'schrägen'],
  ['schraeg', 'schräg'],
  ['Schraeg', 'Schräg'],
  ['vollstaendig', 'vollständig'],
  ['Vollstaendig', 'Vollständig'],
  ['uebereinander', 'übereinander'],
  ['Waende', 'Wände'],
  ['waende', 'wände'],
  ['Schluesse', 'Schlüsse'],
  ['schluesse', 'schlüsse'],
  ['Allergiepaesse', 'Allergiepässe'],
  ['Paesse', 'Pässe'],
  ['paesse', 'pässe'],
  ['aehnlich', 'ähnlich'],
  ['Aehnlich', 'Ähnlich'],
  ['ueberlapp', 'überlapp'],
  ['Ueberlapp', 'Überlapp'],
  ['Aenderung', 'Änderung'],
  ['aenderung', 'änderung'],
  ['aendern', 'ändern'],
  ['Aendern', 'Ändern'],
  ['Saeure', 'Säure'],
  ['saeure', 'säure'],
  ['Loeslich', 'Löslich'],
  ['loeslich', 'löslich'],
  ['geloest', 'gelöst'],
  ['Geloest', 'Gelöst'],
  ['Stoerung', 'Störung'],
  ['stoerung', 'störung'],
  ['voellig', 'völlig'],
  ['regelmaessig', 'regelmäßig'],
  ['Auspraeg', 'Auspreg'],
  ['auspraeg', 'auspreg'],
  ['zuverlaessig', 'zuverlässig'],
  ['Zuverlaessig', 'Zuverlässig'],
  ['laessig', 'lässig'],
  ['Laessig', 'Lässig'],
  ['unabhaengig', 'unabhängig'],
  ['Unabhaengig', 'Unabhängig'],
  ['abhaengig', 'abhängig'],
  ['Abhaengig', 'Abhängig'],
  ['Ernaehr', 'Ernähr'],
  ['ernaehr', 'ernähr'],
  ['schaedigen', 'schädigen'],
  ['Schaedigen', 'Schädigen'],
  ['gefaehrden', 'gefährden'],
  ['Gefaehrden', 'Gefährden'],
  ['bestaetigen', 'bestätigen'],
  ['Bestaetigen', 'Bestätigen'],
  ['Aufloesungsvermo', 'Auflösungsvermö'],
  ['genuegend', 'genügend'],
  ['Genuegend', 'Genügend'],
  ['Bevoelkerung', 'Bevölkerung'],
  ['bevoelkerung', 'bevölkerung'],

  // === Round 6 - comprehensive final sweep ===
  ['Daenemark', 'Dänemark'],
  ['Rumaenien', 'Rumänien'],
  ['Haelften', 'Hälften'],
  ['Haelfte', 'Hälfte'],
  ['haelfte', 'hälfte'],
  ['Gedaechtnispalast', 'Gedächtnispalast'],
  ['Gedaechtnis', 'Gedächtnis'],
  ['gedaechtnis', 'gedächtnis'],
  ['Wortanfaenge', 'Wortanfänge'],
  ['Anfaenge', 'Anfänge'],
  ['anfaenge', 'anfänge'],
  ['Phaenotyp', 'Phänotyp'],
  ['phaenotyp', 'phänotyp'],
  ['Phaenomen', 'Phänomen'],
  ['phaenomen', 'phänomen'],
  ['gleichermassen', 'gleichermaßen'],
  ['Atrioventrikulaer', 'Atrioventrikulär'],
  ['atrioventrikulaer', 'atrioventrikulär'],
  ['intermediaerem', 'intermediärem'],
  ['intermediaer', 'intermediär'],
  ['Schlaegen', 'Schlägen'],
  ['schlaegen', 'schlägen'],
  ['Vorhoefe', 'Vorhöfe'],
  ['vorhoefe', 'vorhöfe'],
  ['gaengig', 'gängig'],
  ['Gaengig', 'Gängig'],
  ['pythagoraeisch', 'pythagoräisch'],
  ['verraet', 'verrät'],
  ['Verraet', 'Verrät'],
  ['Haende', 'Hände'],
  ['haende', 'hände'],
  ['Traenen', 'Tränen'],
  ['traenen', 'tränen'],
  ['aerztin', 'ärztin'],
  ['Aerztin', 'Ärztin'],
  ['Komplementaer', 'Komplementär'],
  ['komplementaer', 'komplementär'],
  ['Kapillaer', 'Kapillär'],
  ['kapillaer', 'kapillär'],
  ['primaer', 'primär'],
  ['Primaer', 'Primär'],
  ['sekundaer', 'sekundär'],
  ['Sekundaer', 'Sekundär'],
  ['regulaer', 'regulär'],
  ['Regulaer', 'Regulär'],
  ['populaer', 'populär'],
  ['Populaer', 'Populär'],
  ['Peripheraer', 'Peripherär'],
  ['peripheraer', 'peripherär'],
  ['Muskulaer', 'Muskulär'],
  ['muskulaer', 'muskulär'],
  ['granulaer', 'granulär'],
  ['Granulaer', 'Granulär'],
  ['molekulaer', 'molekulär'],
  ['Molekulaer', 'Molekulär'],
  ['alveolae', 'alveolä'],
  ['tubulae', 'tubulä'],
  ['vaskulae', 'vaskulä'],
  ['Blaetter', 'Blätter'],
  ['blaetter', 'blätter'],
  ['Gefaesse', 'Gefäße'],
  ['gefaesse', 'gefäße'],
  ['Gefaess', 'Gefäß'],
  ['gefaess', 'gefäß'],
  ['Organuebersicht', 'Organübersicht'],
  ['Darmuebersicht', 'Darmübersicht'],
  ['Koerper', 'Körper'],
  ['koerper', 'körper'],
  ['Hoernerv', 'Hörnerv'],
  ['Stoergroesse', 'Störgröße'],
  ['Zaehler', 'Zähler'],
  ['zaehler', 'zähler'],
  ['Nenner', 'Nenner'],
  ['Saeule', 'Säule'],
  ['saeule', 'säule'],
  ['Uebergang', 'Übergang'],
  ['uebergang', 'übergang'],
  ['Ueberschuss', 'Überschuss'],
  ['ueberschuss', 'überschuss'],
  ['Uebereinstimmung', 'Übereinstimmung'],
  ['Uebertraeger', 'Überträger'],
  ['uebertraeger', 'überträger'],

  // === Round 5 patterns ===
  ['Kraefte', 'Kräfte'],
  ['kraefte', 'kräfte'],
  ['Kraeft', 'Kräft'],
  ['Uebt', 'Übt'],
  ['uebt', 'übt'],
  ['ueben', 'üben'],
  ['Ueben', 'Üben'],
  ['ausgestossenen', 'ausgestoßenen'],
  ['ausgestossen', 'ausgestoßen'],
  ['Stoesse', 'Stöße'],
  ['stoesse', 'stöße'],

  // === More missed patterns (round 4) ===
  ['Kraehenfuessen', 'Krähenfüßen'],
  ['Kraehenfuesse', 'Krähenfüße'],
  ['Laecheln', 'Lächeln'],
  ['laecheln', 'lächeln'],
  ['ueberzeugen', 'überzeugen'],
  ['Ueberzeugen', 'Überzeugen'],
  ['aerztlich', 'ärztlich'],
  ['Aerztlich', 'Ärztlich'],
  ['Aufklaerungspflicht', 'Aufklärungspflicht'],
  ['Fuersorge', 'Fürsorge'],
  ['fuersorge', 'fürsorge'],
  ['Gespraech', 'Gespräch'],
  ['gespraech', 'gespräch'],
  ['moechte', 'möchte'],
  ['Moechte', 'Möchte'],
  ['moechten', 'möchten'],
  ['Moechten', 'Möchten'],
  ['Fuesse', 'Füße'],
  ['fuesse', 'füße'],
  ['fluessig', 'flüssig'],
  ['Fluessig', 'Flüssig'],
  ['Fluessigkeit', 'Flüssigkeit'],
  ['Ruecken', 'Rücken'],
  ['ruecken', 'rücken'],
  ['Rueck', 'Rück'],
  ['rueck', 'rück'],
  ['Drueck', 'Drück'],
  ['drueck', 'drück'],
  ['Brueck', 'Brück'],
  ['brueck', 'brück'],
  ['stuetz', 'stütz'],
  ['Stuetz', 'Stütz'],
  ['schuetz', 'schütz'],
  ['Schuetz', 'Schütz'],
  ['Nuetz', 'Nütz'],
  ['nuetz', 'nütz'],
  ['genuegt', 'genügt'],
  ['Genuegt', 'Genügt'],
  ['Geruech', 'Gerüch'],
  ['geruech', 'gerüch'],
  ['Gemuese', 'Gemüse'],
  ['muede', 'müde'],
  ['Muede', 'Müde'],
  ['muend', 'münd'],
  ['Muend', 'Münd'],
  ['Duenn', 'Dünn'],
  ['duenn', 'dünn'],
  ['Kueh', 'Küh'],
  ['kueh', 'küh'],
  ['Wuest', 'Wüst'],
  ['wuest', 'wüst'],
  ['Buero', 'Büro'],
  ['buero', 'büro'],
  ['Tuere', 'Türe'],
  ['tuere', 'türe'],
  ['Tuer ', 'Tür '],
  ['fuehl', 'fühl'],
  ['Fuehl', 'Fühl'],
  ['fuehr', 'führ'],
  ['Fuehr', 'Führ'],

  // === ss → ß patterns (in German text strings) ===
  ['Abstossung', 'Abstoßung'],
  ['Abstoss', 'Abstoß'],
  ['Ausserdem', 'Außerdem'],
  ['ausserdem', 'außerdem'],
  ['ausser', 'außer'],
  ['Ausser', 'Außer'],

  // === Fuer/fuer with various contexts ===
  // These need careful handling - only in German text, not code
];

// Additional patterns that need word-boundary awareness
const wordBoundaryReplacements = [
  [/\bFuer\b/g, 'Für'],
  [/\bfuer\b/g, 'für'],
  [/\bDafuer\b/g, 'Dafür'],
  [/\bdafuer\b/g, 'dafür'],
  [/\bWofuer\b/g, 'Wofür'],
  [/\bwofuer\b/g, 'wofür'],
  [/\bHierfuer\b/g, 'Hierfür'],
  [/\bhierfuer\b/g, 'hierfür'],
  [/\bprae(?=[A-Z])/g, 'prä-'],
  [/\bprae([a-z])/g, 'prä$1'],
  [/\bGrosse\b/g, 'Große'],
  [/\bgrosse\b/g, 'große'],
  [/\bGross\b/g, 'Groß'],
  [/\bgross\b/g, 'groß'],
  [/\bwaere\b/g, 'wäre'],
  [/\bWaere\b/g, 'Wäre'],
];

function getAllTsFiles(dir) {
  const files = [];
  const entries = fs.readdirSync(dir, { withFileTypes: true });
  for (const entry of entries) {
    const fullPath = path.join(dir, entry.name);
    if (entry.isDirectory()) {
      if (entry.name === 'node_modules' || entry.name === 'dist' || entry.name === '.git') continue;
      files.push(...getAllTsFiles(fullPath));
    } else if (/\.(ts|tsx)$/.test(entry.name)) {
      files.push(fullPath);
    }
  }
  return files;
}

const srcDir = path.join(process.cwd(), 'src');
const files = getAllTsFiles(srcDir);
let totalReplacements = 0;
let filesChanged = 0;

for (const file of files) {
  let content = fs.readFileSync(file, 'utf-8');
  let original = content;

  // Apply string replacements
  for (const [from, to] of replacements) {
    // Replace all occurrences
    while (content.includes(from)) {
      content = content.replace(from, to);
    }
  }

  // Apply regex replacements
  for (const [regex, replacement] of wordBoundaryReplacements) {
    content = content.replace(regex, replacement);
  }

  if (content !== original) {
    fs.writeFileSync(file, content, 'utf-8');
    // Count changes
    let changes = 0;
    for (let i = 0; i < Math.max(content.length, original.length); i++) {
      if (content[i] !== original[i]) changes++;
    }
    const relPath = path.relative(process.cwd(), file);
    console.log(`✓ ${relPath} (modified)`);
    filesChanged++;
    totalReplacements++;
  }
}

console.log(`\nDone! ${filesChanged} files modified.`);
