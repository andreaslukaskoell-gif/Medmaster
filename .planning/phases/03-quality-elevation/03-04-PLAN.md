---
phase: 03-quality-elevation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/data/bmsKapitel/biologie/kap1-die-zelle-test.ts
autonomous: true
gap_closure: true
requirements: [QUAL-01, QUAL-03, QUAL-04]

must_haves:
  truths:
    - "kap1 Unterkapitel have populated merksätze arrays with 5-7 entries each"
    - "kap1 klinischerBezug field contains clinical highlight text from content"
    - "kap1 altfrage field contains exam question-answer pairs from content"
    - "BMSUnterkapitel component renders MerksatzBox components from kap1 merksätze arrays"
  artifacts:
    - path: "src/data/bmsKapitel/biologie/kap1-die-zelle-test.ts"
      provides: "Complete Kapitel 1 with proper MerksatzBox integration"
      contains: "merksätze: ["
  key_links:
    - from: "src/data/bmsKapitel/biologie/kap1-die-zelle-test.ts"
      to: "src/pages/BMSUnterkapitel.tsx"
      via: "merksätze array field"
      pattern: "merksätze:\\s*\\["
---

<objective>
Close Phase 03 verification gaps by extracting MerksatzBox content from kap1 markdown into proper Unterkapitel data structure fields.

Purpose: Ensure kap1 follows the same BMSUnterkapitel.tsx rendering pattern as kap7/kap8 (proper component integration, not plain markdown blockquotes)
Output: kap1-die-zelle-test.ts with populated merksätze, klinischerBezug, and altfrage fields
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-quality-elevation/03-VERIFICATION.md
@src/data/bmsKapitel/biologie/kap1-die-zelle-test.ts
@src/data/bmsKapitel/biologie/kap7-methoden-der-genetik.ts
@src/pages/BMSUnterkapitel.tsx
</context>

<tasks>

<task type="auto">
  <name>Extract MerksatzBox content from kap1 markdown into proper fields</name>
  <files>src/data/bmsKapitel/biologie/kap1-die-zelle-test.ts</files>
  <action>
For each of the 4 Unterkapitel in kap1-die-zelle-test.ts:

**1. Extract merksätze array content:**

**Parsing Method:**
- Split content by lines, scan for pattern: `/^>\s*\*\*MerksatzBox type="(merke|altfragen)":\*\*\s*(.+)$/`
- Extract capture group 2 (the text after the colon)
- Clean text: remove markdown bold markers (`**`), trim whitespace
- Collect 5-7 items per Unterkapitel prioritizing "merke" type blocks
- Populate the `merksätze: []` field with string array

**Example extraction:**
```
Input markdown:
> **MerksatzBox type="merke":** Omnis cellula e cellula – jede Zelle entsteht aus einer Zelle (Rudolf Virchow, 1855).

Output field:
merksätze: ['Omnis cellula e cellula – jede Zelle entsteht aus einer Zelle (Rudolf Virchow, 1855).']
```

**2. Extract klinischerBezug field:**

**Parsing Method:**
- Scan for pattern: `/^>\s*\*\*MerksatzBox type="klinisch":\*\*\s*(.+)$/`
- Extract capture group 1 (clinical text)
- If multiple klinisch blocks exist, concatenate with " | " separator OR select the most comprehensive one
- Create `klinischerBezug` string field in Unterkapitel object

**Example extraction:**
```
Input markdown:
> **MerksatzBox type="klinisch":** Antibiotika nutzen die Unterschiede zwischen Prokaryoten und Eukaryoten aus: Penicillin hemmt die bakterielle Zellwandsynthese, schadet menschlichen Zellen aber nicht, da diese keine Zellwand besitzen.

Output field:
klinischerBezug: 'Antibiotika nutzen die Unterschiede zwischen Prokaryoten und Eukaryoten aus: Penicillin hemmt die bakterielle Zellwandsynthese, schadet menschlichen Zellen aber nicht, da diese keine Zellwand besitzen.'
```

**3. Extract altfrage field:**

**Parsing Method:**
- Scan for pattern: `/^>\s*\*\*MerksatzBox type="altfragen":\*\*\s*(.+)$/`
- Extract capture group 1 (exam hint text)
- Store as simple string field: `altfrage: 'exam hint text'`
- If no altfragen blocks exist in Unterkapitel, omit the field entirely (optional field)

**Example extraction:**
```
Input markdown:
> **MerksatzBox type="altfragen":** Die Na⁺/K⁺-Pumpe ist ein MedAT-Klassiker: Sie pumpt 3 Natrium-Ionen nach außen und 2 Kalium-Ionen nach innen – unter ATP-Verbrauch.

Output field:
altfrage: 'Die Na⁺/K⁺-Pumpe ist ein MedAT-Klassiker: Sie pumpt 3 Natrium-Ionen nach außen und 2 Kalium-Ionen nach innen – unter ATP-Verbrauch.'
```

**4. Remove redundant markdown:**
- KEEP the markdown blockquotes in content field (they provide context in prose)
- Add the structured fields so BMSUnterkapitel.tsx can render proper MerksatzBox components
- The content markdown will still render as prose context, while the extracted fields render as interactive components

**Reference structure from kap7:**
```typescript
{
  id: 'bio-7-01',
  title: 'PCR (Polymerase-Kettenreaktion)',
  content: `...markdown with > **MerksatzBox type="..."** blocks...`,
  lernziele: [],
  sections: [],
  merksätze: [
    'Die PCR verdoppelt DNA-Sequenzen exponentiell...',
    'Drei Schritte pro Zyklus: Denaturierung...',
    'Die Taq-Polymerase aus Thermus aquaticus...',
    // 5 items total
  ],
  klinischerBezug: 'Im klinischen Alltag begegnet dir PCR ständig...',
  selfTest: [...]
}
```

**All 4 Unterkapitel to process:**
- uk01: Zellstruktur und Zellmembran
- uk02: Zellorganellen
- uk03: Zellzyklus und Zellteilung
- uk04: Zellkommunikation

**Expected counts from verification report:**
- Total merksätze to extract: ~28 items (7 per Unterkapitel)
- klinischerBezug instances: 11 (from verification report)
- altfragen instances: 6 (from verification report)
  </action>
  <verify>
1. Read kap1-die-zelle-test.ts and verify each Unterkapitel has:
   - merksätze array with 5-7 string entries (NOT empty)
   - klinischerBezug field with clinical text (if applicable)
   - altfrage field with exam hints (if applicable)

2. Pattern check:
```bash
# Should find 4 non-empty merksätze arrays
grep -c "merksätze: \[" src/data/bmsKapitel/biologie/kap1-die-zelle-test.ts

# Should find klinischerBezug fields
grep -c "klinischerBezug:" src/data/bmsKapitel/biologie/kap1-die-zelle-test.ts
```

3. Build passes:
```bash
npm run build
```
  </verify>
  <done>
All 4 kap1 Unterkapitel have populated merksätze arrays (5-7 items each), klinischerBezug fields where clinical highlights exist in content, and altfrage fields where exam markers exist in content. TypeScript build succeeds without errors.
  </done>
</task>

</tasks>

<verification>
**Gap Closure Checklist:**

1. **QUAL-01 Compliance:**
   - [ ] All 4 kap1 Unterkapitel have non-empty `merksätze: [...]` arrays
   - [ ] Structure matches kap7/kap8 pattern (string array, 5-7 items)
   - [ ] BMSUnterkapitel.tsx will render MerksatzBox components from arrays

2. **QUAL-03 Compliance:**
   - [ ] kap1 has `altfrage` fields populated where exam markers exist in content
   - [ ] Format matches kap7/kap8: `{ question: string, answer: string }` or simple string

3. **QUAL-04 Compliance:**
   - [ ] kap1 has `klinischerBezug` fields populated where clinical highlights exist in content
   - [ ] Text follows "by-doctors-for-future-doctors" framing from content

4. **Build Validation:**
   - [ ] `npm run build` executes successfully
   - [ ] No TypeScript errors related to kap1 data structure

5. **Visual Consistency (manual verification recommended):**
   - Navigate to BMS > Biologie > Die Zelle in running app
   - Verify MerksatzBox components render (glassmorphic cards, not plain blockquotes)
   - Compare visual consistency with kap7 (Methoden der Genetik)
</verification>

<success_criteria>
**Must be TRUE for gap closure:**

1. kap1-die-zelle-test.ts file has 4 Unterkapitel with populated merksätze arrays
2. Each merksätze array contains 5-7 substantive strings extracted from content
3. klinischerBezug field exists and is populated for Unterkapitel with clinical content
4. altfrage field exists and is populated for Unterkapitel with exam markers
5. TypeScript build completes without errors
6. File structure matches kap7/kap8 reference pattern

**What this fixes:**
- Gap 1: QUAL-01 compliance (kap1 now follows BMSUnterkapitel.tsx pattern)
- Gap 2: QUAL-03 & QUAL-04 compliance (markers now in proper structure)
- Gap 3: Markdown content now properly wired to component rendering

**What verification will show:**
- VERIFICATION.md truths 1, 5, 6 will change from FAILED/PARTIAL to VERIFIED
- BMSUnterkapitel.tsx will render interactive MerksatzBox components for kap1
- Visual rendering will match kap7/kap8 (no more plain HTML blockquotes)
</success_criteria>

<output>
After completion, create `.planning/phases/03-quality-elevation/03-04-SUMMARY.md` following the standard summary template.
</output>
