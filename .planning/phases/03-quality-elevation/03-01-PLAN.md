---
phase: 03-quality-elevation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/store/useStore.ts
  - src/components/chapter/MerksatzBox.tsx
  - src/components/ui/premium-badge.tsx
autonomous: true
requirements: [QUAL-01, QUAL-04]

must_haves:
  truths:
    - "useStore.ts contains isPro state and setIsPro action"
    - "MerksatzBox component applies glassmorphism styling with Framer Motion"
    - "Premium content can be gated via isPro checks"
  artifacts:
    - path: "src/store/useStore.ts"
      provides: "isPro state management"
      exports: ["isPro", "setIsPro"]
      min_lines: 600
    - path: "src/components/chapter/MerksatzBox.tsx"
      provides: "Premium glassmorphic MerksatzBox with animations"
      min_lines: 80
    - path: "src/components/ui/premium-badge.tsx"
      provides: "Premium content indicator component"
      min_lines: 20
  key_links:
    - from: "src/store/useStore.ts"
      to: "AppState interface"
      via: "isPro boolean field"
      pattern: "isPro:\\s*boolean"
    - from: "src/components/chapter/MerksatzBox.tsx"
      to: "framer-motion"
      via: "motion.div import"
      pattern: "from ['\"]framer-motion['\"]"
---

<objective>
Establish freemium architecture foundation by implementing isPro logic in useStore.ts and upgrading MerksatzBox component to premium glassmorphism standards with Framer Motion animations.

Purpose: Prepare the technical architecture for Phase 8 freemium features while elevating MerksatzBox visual quality to match QuizQuestion.tsx premium standards (which already uses glassmorphism).

Output: isPro state ready for content gating, MerksatzBox upgraded with glass effects and animations, premium badge component for marking pro content.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-quality-elevation/03-CONTEXT.md
@.planning/phases/03-quality-elevation/03-RESEARCH.md
@src/store/useStore.ts
@src/components/chapter/MerksatzBox.tsx
@src/components/chapter/QuizQuestion.tsx
</context>

<tasks>

<task type="auto">
  <name>Add isPro state to useStore.ts</name>
  <files>src/store/useStore.ts</files>
  <action>
Add isPro boolean state and setIsPro action to AppState interface and create() function in useStore.ts.

**Add to AppState interface (after line 170):**
```typescript
/** Premium subscription status (true = active subscription or beta access) */
isPro: boolean;
setIsPro: (value: boolean) => void;
```

**Add to create() function initial state (after line 237):**
```typescript
isPro: false,
```

**Add to create() function actions (after line 239):**
```typescript
setIsPro: (value) => set({ isPro: value }),
```

**IMPORTANT:** Do NOT add isPro to partialize() exclusion list (line 554) - it should NOT be excluded from persistence (unlike xpMultiplier and pendingBadgeId). Premium status should persist across sessions.

**Context from CONTEXT.md Decision 2:**
- No paywall implementation yet (Phase 8)
- Architecture must be ready for content gating
- All content marked 'Pro' in Phase 1/2 must check isPro

**Verification:** Use grep to confirm isPro appears in interface, initial state, and action, but NOT in partialize exclusion.
  </action>
  <verify>
grep -n "isPro" src/store/useStore.ts | wc -l  # Should show 3+ occurrences
npm run build  # Must complete without errors
  </verify>
  <done>isPro state exists in AppState interface, initial state is false, setIsPro action implemented, build passes</done>
</task>

<task type="auto">
  <name>Upgrade MerksatzBox with glassmorphism and Framer Motion</name>
  <files>src/components/chapter/MerksatzBox.tsx</files>
  <action>
Enhance MerksatzBox component to match QuizQuestion.tsx premium glassmorphism standards using Framer Motion for smooth reveal animations.

**Add Framer Motion import (line 1):**
```typescript
import { motion } from "framer-motion";
```

**Wrap outer div with motion.div and add glassmorphism (replace line 52-58):**
```typescript
<motion.div
  initial={{ opacity: 0, y: 4 }}
  animate={{ opacity: 1, y: 0 }}
  transition={{ duration: 0.3, ease: "easeOut" }}
  className={`relative ${c.bg} backdrop-blur-sm border ${c.border} rounded-xl p-4 my-6 shadow-sm hover:shadow-md transition-shadow`}
>
  <p className={`font-bold ${c.title} flex items-center gap-2`}>
    {c.icon} {c.label}
  </p>
  <p className={`${c.body} mt-1 text-sm leading-relaxed`} dangerouslySetInnerHTML={{ __html: text }} />
</motion.div>
```

**Pattern reference from QuizQuestion.tsx (lines 62-67):**
- Uses `backdrop-blur-md` for glass effect
- Adds `shadow-sm hover:shadow-md transition-shadow` for depth
- Framer Motion with `initial`, `animate`, `transition` for smooth reveal
- Easing: `easeOut` (0.3s duration)

**Apply to all 5 MerksatzBox types:** merke, altfragen, klinisch, achtung, tipp

**Dark mode:** Existing `dark:` variants in config already handle dark mode correctly (bg opacity, border colors).

**Accessibility:** Keep existing semantic HTML structure, aria labels not needed (icon is decorative, label is visible text).
  </action>
  <verify>
grep "motion.div" src/components/chapter/MerksatzBox.tsx  # Should find motion wrapper
grep "backdrop-blur" src/components/chapter/MerksatzBox.tsx  # Should find glass effect
npm run build  # Must complete without errors
  </verify>
  <done>MerksatzBox uses motion.div with glassmorphism (backdrop-blur-sm), smooth fade-in animation (0.3s easeOut), hover shadow transition, build passes</done>
</task>

<task type="auto">
  <name>Create PremiumBadge component for content gating UI</name>
  <files>src/components/ui/premium-badge.tsx</files>
  <action>
Create a reusable PremiumBadge component to mark premium content. This component will be used in Phase 8 for actual paywall UI, but provides the visual indicator now.

**Create new file src/components/ui/premium-badge.tsx:**
```typescript
import { Crown } from "lucide-react";

interface PremiumBadgeProps {
  size?: "sm" | "md" | "lg";
  variant?: "inline" | "overlay";
}

export function PremiumBadge({ size = "sm", variant = "inline" }: PremiumBadgeProps) {
  const sizeClasses = {
    sm: "text-xs px-2 py-0.5 gap-1",
    md: "text-sm px-3 py-1 gap-1.5",
    lg: "text-base px-4 py-2 gap-2",
  };

  const iconSizes = {
    sm: "w-3 h-3",
    md: "w-4 h-4",
    lg: "w-5 h-5",
  };

  if (variant === "overlay") {
    return (
      <div className="absolute top-2 right-2 bg-gradient-to-r from-amber-500 to-yellow-500 text-white rounded-full px-3 py-1 text-xs font-bold shadow-md flex items-center gap-1 backdrop-blur-sm">
        <Crown className="w-3 h-3" />
        PRO
      </div>
    );
  }

  return (
    <span className={`inline-flex items-center ${sizeClasses[size]} bg-gradient-to-r from-amber-500 to-yellow-500 text-white rounded-full font-bold`}>
      <Crown className={iconSizes[size]} />
      PRO
    </span>
  );
}
```

**Usage patterns (documented in component JSDoc - add above interface):**
```typescript
/**
 * Premium content indicator badge.
 *
 * Usage:
 * - inline: Next to chapter titles, question numbers
 * - overlay: Top-right corner of cards/boxes
 *
 * Phase 3: Visual indicator only
 * Phase 8: Will be paired with actual content gating logic
 *
 * @example
 * <PremiumBadge size="sm" variant="inline" />
 * <div className="relative">
 *   <PremiumBadge variant="overlay" />
 *   <ContentCard />
 * </div>
 */
```

**DO NOT implement actual gating logic** - this is UI-only per CONTEXT.md deferred ideas.
  </action>
  <verify>
cat src/components/ui/premium-badge.tsx | grep -c "Crown"  # Should find icon import
npm run build  # Must complete without errors
  </verify>
  <done>PremiumBadge component created with inline/overlay variants, size options (sm/md/lg), Crown icon from lucide-react, gradient amber-to-yellow styling, build passes</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - must complete without TypeScript errors
2. Check `src/store/useStore.ts` for isPro field in AppState interface
3. Check `src/components/chapter/MerksatzBox.tsx` for motion.div and backdrop-blur
4. Check `src/components/ui/premium-badge.tsx` exists with PremiumBadge export
5. Verify no console errors when rendering MerksatzBox (Framer Motion animations work)
</verification>

<success_criteria>
- isPro boolean state exists in useStore.ts with setIsPro action
- MerksatzBox component uses Framer Motion with glassmorphism effects
- PremiumBadge component ready for marking premium content
- All components render without errors in development build
- Phase 8 freemium architecture foundation is in place (no paywall UI, just plumbing)
</success_criteria>

<output>
After completion, create `.planning/phases/03-quality-elevation/03-01-SUMMARY.md`
</output>
